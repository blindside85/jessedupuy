---
import HtmlHead from "@components/HtmlHead.astro";
import Icons from "@components/Icons.astro";
import BodyTop from "@components/BodyTop.astro";
import BaseHeader from "@components/BaseHeader.astro";
import TagLink from "@components/TagLink.astro";
import Footer from "@components/Footer.astro";
import { SITE } from "@/config";
import "@styles/vars.css";
import "@styles/core.css";
import "@styles/post.css";

const { frontmatter } = Astro.props;
let title;
if (Astro.url.host.includes("localhost")) {
  title = `DEV: ${frontmatter.title} | ${SITE.name}`;
} else {
  title = `${frontmatter.title} | ${SITE.name}`;
}
const msg = "Reading is one of my favorite things to do. How about you?";

// BlogPosting schema for SEO
const blogPostingSchema = {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": frontmatter.title,
  "description": frontmatter.description,
  "author": {
    "@type": "Person",
    "name": frontmatter.author,
    "url": SITE.url
  },
  "datePublished": frontmatter.pubDate.toISOString(),
  "publisher": {
    "@type": "Person",
    "name": SITE.name,
    "url": SITE.url
  },
  "url": new URL(Astro.url.pathname, SITE.url).href,
  "keywords": frontmatter.tags.join(", "),
  ...(frontmatter.image?.url && {
    "image": new URL(frontmatter.image.url, SITE.url).href
  })
};
---

<!doctype html>
<html lang="en">
  <head>
    <HtmlHead {title} desc={frontmatter.description} />
    <script type="application/ld+json" set:html={JSON.stringify(blogPostingSchema)} />
  </head>

  <body>
    <a href="#main" class="skip-link">Skip to main content</a>
    <Icons />
    <BodyTop {msg} />
    <div class="wrapper">
      <BaseHeader title={frontmatter.title} />
      <main id="main">
        <article>
          <section class="post-hero">
            <section class="post-info">
              <h1>{frontmatter.title}</h1>
              <time datetime={frontmatter.pubDate.toISOString()}>
                {frontmatter.pubDate.toDateString()}
              </time>
              <section class="post-tags">
                <ul>
                  {
                    frontmatter.tags.map((tag: string) => (
                      <li class="tag">
                        <TagLink {tag} />
                      </li>
                    ))
                  }
                </ul>
              </section>
            </section>
            {
              frontmatter.image && (
                <img
                  src={frontmatter.image.url}
                  alt={frontmatter.image.alt}
                  loading="eager"
                  decoding="async"
                />
              )
            }
          </section>

          <section class="post-content">
            <slot />
          </section>
        </article>
      </main>
      <Footer />
    </div>
  </body>
</html>
